<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ê´€ë¦¬ì ëª¨ë“œ - NICU wanted off</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .btn-admin {
      @apply px-4 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700 transition;
    }
    .cell-booked { @apply bg-red-100; }
    .cell-open   { @apply bg-green-100 cursor-pointer hover:bg-green-200; }
    .admin-added { @apply font-bold bg-yellow-200; }
    .disabled    { @apply opacity-50 cursor-not-allowed; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen p-6">

  <h1 class="text-3xl font-bold mb-6">âš™ï¸ ê´€ë¦¬ì ëª¨ë“œ</h1>
  <button id="logoutAdmin" class="btn-admin mb-4">ë¡œê·¸ì•„ì›ƒ</button>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- ë‹¬ë ¥ ì˜ì—­ -->
    <div class="lg:col-span-2 overflow-x-auto">
      <table class="w-full bg-white rounded-lg shadow text-center">
        <thead class="bg-indigo-100">
          <tr>
            <th class="p-2">ì¼</th><th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th>í† </th>
          </tr>
        </thead>
        <tbody id="adminCalendar" class="divide-y"></tbody>
      </table>
    </div>

    <!-- ìš°ì¸¡: ìƒì„¸ + NICU ëª©ë¡ -->
    <div class="space-y-6">
      <div id="details" class="bg-white p-4 rounded-lg shadow">
        <h2 id="detailDate" class="text-xl font-semibold mb-2">ë‚ ì§œ ì„ íƒ</h2>
        <ul id="detailList" class="space-y-2"></ul>
      </div>
      <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-2">NICU</h2>
        <ul id="whitelist" class="grid grid-cols-3 gap-2"></ul>
      </div>
    </div>
  </div>

  <script>
  window.addEventListener('DOMContentLoaded', () => {
    const getData       = () => JSON.parse(localStorage.getItem('app_data')      || '{}');
    const saveData      = d => localStorage.setItem('app_data',      JSON.stringify(d));
    const getAdminAdds  = () => JSON.parse(localStorage.getItem('app_adminAdds')|| '{}');
    const saveAdminAdds = d => localStorage.setItem('app_adminAdds', JSON.stringify(d));
    const allowedNames  = ["ì²œì§€ì›","ì´ì‹œí–¥","ì´ìŠ¬ë¹„","ì´ì˜ìˆ™","êµ¬ìŠ¬ë¹„","ê¹€ì •í˜„","ê³ ì˜í™”","ì˜¤í˜„ì§€","ì´ì§€ìˆ˜","ì „í˜œì„ ","ì¡°í™”ì—°","ìœ¤ìˆ˜ì§„","ìµœì›ì •","ê¶Œë‚˜ê²½","ê¹€ì£¼í˜„","ê¹€ìœ ì§„","ë°°ì¸ê²½","ì´í˜œìˆ˜","ì„œì˜ì„œ","í™ìˆ˜ì•„","ë°•ì£¼í˜„","ì—„ë‚˜í˜œ","ì´ìˆ˜ì§€","ì •í˜œì•„","ì´ì‹œì€","ë°±ì§€ì—°","í—ˆìë ¹","ê¹€ìˆ˜ë¯¼","ì´ë‹¤ê²½","ì‹ ì˜¥ë¹„","ë°•ì¸í¬","ì‹ ì£¼ì˜","ìµœì€ë°©","ê¸¸ìš©ìˆœ","í•œì€ì§„","ì‹¬ë‚˜ì˜","ë°•í¬ì—°","ì›ìœ ë¯¸","ì¸íœ˜"];

    const adminCal   = document.getElementById('adminCalendar');
    const detailDate = document.getElementById('detailDate');
    const detailList = document.getElementById('detailList');
    const whitelist  = document.getElementById('whitelist');
    const logoutBtn  = document.getElementById('logoutAdmin');

    let cur = new Date(), selectedDate = '';

    logoutBtn.onclick = () => {
      localStorage.removeItem('app_current');
      location.href = 'index.html';
    };

    function renderCalendar() {
      adminCal.innerHTML = '';
      const year  = cur.getFullYear(),
            month = cur.getMonth(),
            first = new Date(year, month, 1).getDay(),
            days  = new Date(year, month+1, 0).getDate();
      let row = document.createElement('tr');

      for (let i=0; i<first; i++) row.appendChild(document.createElement('td'));

      const data      = getData();
      const adminAdds = getAdminAdds();

      for (let d=1; d<=days; d++) {
        if ((first + d - 1) % 7 === 0 && d !== 1) {
          adminCal.appendChild(row);
          row = document.createElement('tr');
        }
        const ds    = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const users = data[ds]      || [];
        const adds  = adminAdds[ds] || [];
        const names = users.concat(adds.map(n => `ğŸ‘‘ ${n}`));

        const td = document.createElement('td');
        td.className = names.length > 0 ? 'cell-booked p-2' : 'cell-open p-2';
        td.innerHTML = `<div class="font-semibold mb-1">${d}</div>` +
                       names.map(n=>`<div class="text-sm">${n}</div>`).join('');
        td.onclick = () => showDetails(ds);
        row.appendChild(td);
      }

      while (row.children.length < 7) row.appendChild(document.createElement('td'));
      adminCal.appendChild(row);
    }

    function showDetails(date) {
      selectedDate = date;
      detailDate.textContent = `ì˜ˆì•½ì ëª©ë¡ â€” ${date}`;
      detailList.innerHTML = '';

      const data      = getData();
      const adminAdds = getAdminAdds();
      const users     = data[date]      || [];
      const adds      = adminAdds[date] || [];

      // ì‚¬ìš©ì ì˜ˆì•½
      users.forEach((name, i) => {
        const li = document.createElement('li');
        li.className = 'flex justify-between items-center';
        li.innerHTML = `<span>${i+1}. ${name}</span><button class="text-red-500">ì·¨ì†Œ</button>`;
        li.querySelector('button').onclick = () => {
          if (!confirm(`${name} ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
          const updated = users.filter(n => n !== name);
          if (updated.length) data[date] = updated; else delete data[date];
          saveData(data);
          renderCalendar(); showDetails(date);
        };
        detailList.appendChild(li);
      });

      // ê´€ë¦¬ì ì¶”ê°€ ì˜ˆì•½
      adds.forEach((name, i) => {
        const li = document.createElement('li');
        li.className = 'flex justify-between items-center admin-added';
        li.innerHTML = `<span>${users.length+i+1}. ğŸ‘‘ ${name}</span><button class="text-red-500">ì·¨ì†Œ</button>`;
        li.querySelector('button').onclick = () => {
          if (!confirm(`${name} ê´€ë¦¬ì ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
          const updated = adds.filter(n => n !== name);
          if (updated.length) adminAdds[date] = updated; else delete adminAdds[date];
          saveAdminAdds(adminAdds);
          renderCalendar(); showDetails(date);
        };
        detailList.appendChild(li);
      });

      if (users.length === 0 && adds.length === 0) {
        detailList.textContent = 'ì˜ˆì•½ìê°€ ì—†ìŠµë‹ˆë‹¤.';
      }

      // NICU ëª©ë¡ (ê°€ë‚˜ë‹¤ìˆœ, 3ì—´)
      whitelist.innerHTML = '';
      const namesList = [...allowedNames].sort((a, b) => a.localeCompare(b, 'ko'));
      namesList.forEach(name => {
        const li = document.createElement('li');
        li.className = 'flex justify-center';
        const btn = document.createElement('button');
        btn.textContent = name;
        btn.className = 'btn-admin w-full';
        const allCount = users.length + adds.length;
        const already = users.includes(name) || adds.includes(name);
        if (already || allCount >= 3) {
          btn.disabled = true;
          btn.classList.add('disabled');
        } else {
          btn.onclick = () => {
            adminAdds[date] = (adminAdds[date] || []).concat(name);
            saveAdminAdds(adminAdds);
            renderCalendar(); showDetails(date);
          };
        }
        li.appendChild(btn);
        whitelist.appendChild(li);
      });
    }

    renderCalendar();
  });
  </script>
</body>
</html>
